# MyNanoFormSnapper - Technical Architecture

**Detailed system design and data flow documentation**

---

## Table of Contents
1. [System Overview](#system-overview)
2. [Google Cloud Infrastructure](#google-cloud-infrastructure)
3. [Chrome Extension Architecture](#chrome-extension-architecture)
4. [Data Flow Diagrams](#data-flow-diagrams)
5. [AI Inference Routing](#ai-inference-routing)
6. [Storage Management](#storage-management)
7. [Voice Assistant Architecture](#voice-assistant-architecture)
8. [Security & Privacy](#security--privacy)

---

## System Overview

MyNanoFormSnapper is a Chrome extension built with a serverless Google Cloud backend, hybrid AI inference, and intelligent storage management.

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          User's Browser                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Chrome Extension                             â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Content    â”‚  â”‚   Service    â”‚  â”‚   Extension      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Scripts    â”‚  â”‚   Worker     â”‚  â”‚   Popup UI       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚ (background) â”‚  â”‚  (panel-injector)â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Form Det. â”‚  â”‚ - AI Logic   â”‚  â”‚  - Settings      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Field Fillâ”‚  â”‚ - Storage    â”‚  â”‚  - Upload        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Voice UI  â”‚  â”‚ - Cloud Sync â”‚  â”‚  - KB Mgmt       â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚         â”‚                â”‚                    â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                â”‚                    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                    â”‚
             â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
             â”‚         â”‚  Chrome APIs  â”‚           â”‚
             â”‚         â”‚  - Storage    â”‚           â”‚
             â”‚         â”‚  - Runtime    â”‚           â”‚
             â”‚         â”‚  - Tabs       â”‚           â”‚
             â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
             â”‚                â”‚                    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Google Cloud â”‚   â”‚  Gemini AI APIs   â”‚   â”‚ Chrome Built-in â”‚
â”‚ Infrastructureâ”‚   â”‚                   â”‚   â”‚      AI         â”‚
â”‚               â”‚   â”‚  - Gemini 2.5     â”‚   â”‚  - Gemini Nano  â”‚
â”‚  - Functions  â”‚   â”‚    Flash          â”‚   â”‚  - Prompt API   â”‚
â”‚  - Storage    â”‚   â”‚  - Live API 2.5   â”‚   â”‚                 â”‚
â”‚  - IAM        â”‚   â”‚  - Embeddings     â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Google Cloud Infrastructure

### Cloud Functions Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Google Cloud Functions (Gen2)                  â”‚
â”‚                 Region: us-central1                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚scrape-  â”‚  â”‚  save-  â”‚  â”‚retrieve- â”‚  â”‚ delete-  â”‚
    â”‚linkedin â”‚  â”‚embeddingsâ”‚ â”‚embeddingsâ”‚  â”‚embeddingsâ”‚
    â”‚         â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚
    â”‚Python311â”‚  â”‚Python311 â”‚  â”‚Python311 â”‚  â”‚Python311 â”‚
    â”‚512MB    â”‚  â”‚512MB     â”‚  â”‚512MB     â”‚  â”‚256MB     â”‚
    â”‚540s     â”‚  â”‚540s      â”‚  â”‚540s      â”‚  â”‚540s      â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚             â”‚             â”‚
         â”‚       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚       â”‚    Google Cloud Storage Bucket        â”‚
         â”‚       â”‚   myformsnapper-embeddings            â”‚
         â”‚       â”‚   - Standard class                    â”‚
         â”‚       â”‚   - us-central1 region                â”‚
         â”‚       â”‚   - Unlimited capacity                â”‚
         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Toolhouse API  â”‚
    â”‚ (3rd party)     â”‚
    â”‚ LinkedIn Scraperâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cloud Function Specifications

| Function | Purpose | Memory | Timeout | Concurrency |
|----------|---------|--------|---------|-------------|
| **scrape-linkedin** | Scrape LinkedIn profiles | 512MB | 540s | Auto-scale |
| **save-embeddings** | Save to Cloud Storage | 512MB | 540s | Auto-scale |
| **retrieve-embeddings** | Retrieve from Cloud Storage | 512MB | 540s | Auto-scale |
| **delete-embeddings** | Delete from Cloud Storage | 256MB | 540s | Auto-scale |

### Cloud Storage Structure

```
gs://myformsnapper-embeddings/
  â””â”€â”€ users/
      â””â”€â”€ {userId}/                    # UUID per user
          â””â”€â”€ documents/
              â”œâ”€â”€ {documentId}/        # UUID per document
              â”‚   â”œâ”€â”€ chunks.json      # Embedding vectors (768-dim)
              â”‚   â””â”€â”€ metadata.json    # Document metadata
              â”œâ”€â”€ {documentId}/
              â”‚   â”œâ”€â”€ chunks.json
              â”‚   â””â”€â”€ metadata.json
              â””â”€â”€ ...
```

**chunks.json format:**
```json
[
  {
    "fileName": "resume.pdf",
    "chunkIndex": 0,
    "text": "John Doe is a Software Engineer...",
    "embedding": [0.123, -0.456, 0.789, ...],  // 768 dimensions
    "hash": "a1b2c3d4e5f6",
    "timestamp": 1699564800000
  },
  ...
]
```

**metadata.json format:**
```json
{
  "fileName": "resume.pdf",
  "documentId": "doc_abc123",
  "chunksProcessed": 15,
  "uploadedAt": 1699564800000,
  "storage": "cloud"
}
```

---

## Chrome Extension Architecture

### Manifest V3 Structure

```json
{
  "manifest_version": 3,
  "name": "MyNanoFormSnapper",
  "version": "2.0.0",

  "background": {
    "service_worker": "dist/background.js",
    "type": "module"
  },

  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": [
        "panel-injector.js",
        "gemini-live-voice-wrapper.js"
      ]
    }
  ],

  "permissions": [
    "storage",
    "activeTab",
    "scripting"
  ],

  "host_permissions": [
    "https://generativelanguage.googleapis.com/*",
    "https://us-central1-crafty-cairn-469222-a8.cloudfunctions.net/*"
  ]
}
```

### Component Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Message Flow                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Content Script              Service Worker              Cloud
  (panel-injector.js)         (background.js)

       â”‚                            â”‚
       â”‚  1. embedDocument          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                            â”‚
       â”‚                            â”‚  2. Generate embeddings
       â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                            â”‚                    Gemini API
       â”‚                            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚     3. Embeddings
       â”‚                            â”‚
       â”‚                            â”‚  4. Save to storage
       â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                            â”‚                    Cloud Storage
       â”‚                            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚     5. Success
       â”‚  6. Embedding complete     â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚
       â”‚  7. fillForm               â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                            â”‚
       â”‚                            â”‚  8. Analyze form
       â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                            â”‚                    Gemini API
       â”‚                            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚     9. Field values
       â”‚  10. Fill instructions     â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                            â”‚
```

---

## Data Flow Diagrams

### 1. Document Upload Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Uploads â”‚
â”‚   PDF   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ panel-injector  â”‚ 1. Read file content
â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ File.text()     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                       â”‚
     â”‚ 2. Chunk text         â”‚
     â”‚ (500 words/chunk,     â”‚
     â”‚  100-word overlap)    â”‚
     â”‚                       â”‚
     â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  background.js  â”‚          â”‚
â”‚  Service Worker â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                       â”‚
     â”‚ 3. For each chunk     â”‚
     â”‚                       â”‚
     â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Gemini Embedding API     â”‚â”‚
â”‚  text-embedding-004       â”‚â”‚
â”‚  768-dimensional vectors  â”‚â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
     â”‚                       â”‚
     â”‚ 4. Return embeddings  â”‚
     â”‚                       â”‚
     â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ storage-manager â”‚          â”‚
â”‚  .saveEmbeddingsâ”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                       â”‚
     â”‚ 5. Cloud or Local?    â”‚
     â”‚                       â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚          â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloud   â”‚ â”‚ Local Storage â”‚
â”‚ Storage  â”‚ â”‚ (10MB limit)  â”‚
â”‚(Unlimited)â”‚ â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Form Filling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Clicks  â”‚
â”‚"Fill    â”‚
â”‚ Form"   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ panel-injector.js               â”‚
â”‚ 1. Extract form HTML            â”‚
â”‚ 2. Estimate token count         â”‚
â”‚    (HTML length / 4)            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Send to Service Worker
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ background.js                   â”‚
â”‚ 4. Route based on size          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚          â”‚                â”‚
     â”‚ Small    â”‚ Large          â”‚
     â”‚ (<6K     â”‚ (>6K           â”‚
     â”‚ tokens)  â”‚ tokens)        â”‚
     â”‚          â”‚                â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gemini   â”‚ â”‚  Gemini    â”‚ â”‚   Gemini     â”‚
â”‚  Nano    â”‚ â”‚  2.5 Flash â”‚ â”‚   2.5 Flash  â”‚
â”‚(On-device)â”‚ â”‚  (Cloud)   â”‚ â”‚   (Cloud)    â”‚
â”‚ Optional â”‚ â”‚  Fallback  â”‚ â”‚   Primary    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 5. Two-stage analysis
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Stage 1:          â”‚
     â”‚  Form Structure    â”‚
     â”‚  Detection         â”‚
     â”‚                    â”‚
     â”‚  Extract:          â”‚
     â”‚  - Field labels    â”‚
     â”‚  - Field types     â”‚
     â”‚  - Field IDs       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 6. Search KB
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Semantic Search   â”‚
     â”‚  with Embeddings   â”‚
     â”‚                    â”‚
     â”‚  Cosine Similarity â”‚
     â”‚  Top 5 chunks      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 7. Extract values
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Stage 2:          â”‚
     â”‚  Value Extraction  â”‚
     â”‚                    â”‚
     â”‚  Match KB chunks   â”‚
     â”‚  to form fields    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 8. Return JSON
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ {                  â”‚
     â”‚   "Email": "...",  â”‚
     â”‚   "Phone": "...",  â”‚
     â”‚   "Name": "..."    â”‚
     â”‚ }                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ 9. Auto-fill
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ panel-injector.js  â”‚
     â”‚ Fill form fields   â”‚
     â”‚ using DOM          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. LinkedIn Import Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Pastes  â”‚
â”‚LinkedIn â”‚
â”‚   URL   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ panel-injector.js                â”‚
â”‚ 1. Validate URL format           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Call Cloud Function
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Function: scrape-linkedin          â”‚
â”‚ https://us-central1-...                  â”‚
â”‚   cloudfunctions.net/scrape-linkedin     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Forward to Toolhouse API
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toolhouse AI Agent               â”‚
â”‚ Scrapes LinkedIn profile         â”‚
â”‚                                  â”‚
â”‚ Returns JSON:                    â”‚
â”‚ {                                â”‚
â”‚   "name": "John Doe",            â”‚
â”‚   "headline": "Engineer...",     â”‚
â”‚   "experience": [...],           â”‚
â”‚   "education": [...],            â”‚
â”‚   "skills": [...]                â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Convert to text
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ panel-injector.js                â”‚
â”‚ 5. Format as resume text         â”‚
â”‚                                  â”‚
â”‚ "John Doe                        â”‚
â”‚  Software Engineer at Google     â”‚
â”‚  Experience:                     â”‚
â”‚  - Software Engineer (2020-...)  â”‚
â”‚  Education:                      â”‚
â”‚  - MIT (2016-2020)               â”‚
â”‚  Skills: Python, JS, ..."        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Create virtual file
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ new File([text],                 â”‚
â”‚   "LinkedIn_JohnDoe.txt",        â”‚
â”‚   { type: "text/plain" })        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. Process through
     â”‚    embedding pipeline
     â”‚    (same as PDF upload)
     â”‚
     â–¼
[See Document Upload Flow above]
```

---

## AI Inference Routing

### Decision Tree

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ User clicks  â”‚
                  â”‚ "Fill Form"  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Extract HTML    â”‚
               â”‚ Estimate tokens â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ tokens > 6000?       â”‚
              â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                 â”‚NO            â”‚YES
                 â”‚              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Small Form   â”‚  â”‚  Large Form    â”‚
        â”‚  (<6K tokens) â”‚  â”‚  (>6K tokens)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚              â”‚
                 â–¼              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Try Gemini Nano  â”‚  â”‚  Use Gemini    â”‚
       â”‚   (On-device)    â”‚  â”‚  2.5 Flash     â”‚
       â”‚                  â”‚  â”‚  (Cloud)       â”‚
       â”‚ If available:    â”‚  â”‚                â”‚
       â”‚ âœ… Fast (<200ms) â”‚  â”‚ âœ… Accurate    â”‚
       â”‚ âœ… Private       â”‚  â”‚ âœ… Large       â”‚
       â”‚ âœ… Free          â”‚  â”‚    context     â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
            â”‚ If fails or         â”‚
            â”‚ not available       â”‚
            â”‚                     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Fallback to      â”‚
          â”‚ Gemini 2.5 Flash â”‚
          â”‚ (Cloud)          â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Return field     â”‚
       â”‚ values as JSON   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Model Selection Matrix

| Form Size | Primary Model | Fallback Model | Execution Time | Privacy |
|-----------|--------------|----------------|----------------|---------|
| **Small** (<6K tokens) | Gemini Nano (on-device) | Gemini 2.5 Flash (cloud) | <200ms | 100% private |
| **Large** (>6K tokens) | Gemini 2.5 Flash (cloud) | N/A | <2 seconds | Data sent to Google |

---

## Storage Management

### Storage Manager Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             StorageManager (Abstraction Layer)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  - mode: 'local' | 'cloud'                               â”‚
â”‚  - userId: UUID                                          â”‚
â”‚                                                          â”‚
â”‚  Methods:                                                â”‚
â”‚  - saveEmbeddings(fileName, chunks, metadata)            â”‚
â”‚  - retrieveEmbeddings(documentId)                        â”‚
â”‚  - deleteEmbeddings(fileName)                            â”‚
â”‚  - setMode(mode)                                         â”‚
â”‚  - getMode()                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚
             â”‚ mode='local'           â”‚ mode='cloud'
             â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Local Storage  â”‚      â”‚  Cloud Storage      â”‚
    â”‚                 â”‚      â”‚                     â”‚
    â”‚ - Chrome API    â”‚      â”‚ - Cloud Functions   â”‚
    â”‚ - 10MB limit    â”‚      â”‚ - Google Storage    â”‚
    â”‚ - Synchronous   â”‚      â”‚ - Unlimited         â”‚
    â”‚ - Offline OK    â”‚      â”‚ - Async             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Storage Mode Comparison

| Feature | Local Storage | Cloud Storage |
|---------|--------------|---------------|
| **Capacity** | 10MB (~20-30 docs) | Unlimited (petabytes) |
| **Speed** | Instant (<10ms) | Fast (~500ms) |
| **Privacy** | 100% private | Data in cloud |
| **Offline** | âœ… Yes | âŒ No |
| **Multi-device** | âŒ No | âœ… Yes |
| **Cost** | Free | ~$0.02/GB/month |
| **Backup** | Manual | Automatic |

### Migration Between Modes

When user switches storage mode:

```javascript
// User switches from Local â†’ Cloud
async function migrateToCloud() {
  // 1. Retrieve all local embeddings
  const localChunks = await chrome.storage.local.get(['knowledgeBase']);

  // 2. Upload to Cloud Storage
  for (const doc of localChunks.knowledgeBase) {
    await storageManager.saveToCloud(doc.fileName, doc.chunks, doc.metadata);
  }

  // 3. Verify cloud save successful
  // 4. Clear local storage (optional)
  // 5. Update mode to 'cloud'
  await storageManager.setMode('cloud');
}
```

---

## Voice Assistant Architecture

### Gemini Live API Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Voice Assistant Flow                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User                Content Script        Service Worker      Gemini Live API

   â”‚                       â”‚                      â”‚                    â”‚
   â”‚ 1. Click voice btn    â”‚                      â”‚                    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚ 2. Wake up worker    â”‚                    â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚ 3. Create port       â”‚                    â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚ 4. Init session    â”‚
   â”‚                       â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                      â”‚  5. Session ready  â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚ 6. Start mic         â”‚                    â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚ 7. Speak: "john@..."  â”‚                      â”‚                    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚ 8. Stream audio      â”‚                    â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚ 9. Send audio      â”‚
   â”‚                       â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                      â”‚ 10. AI response    â”‚
   â”‚                       â”‚                      â”‚  + function call   â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚                       â”‚ 11. Function call    â”‚                    â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
   â”‚                       â”‚  submitFieldValue(   â”‚                    â”‚
   â”‚                       â”‚    "Email",          â”‚                    â”‚
   â”‚                       â”‚    "john@..."        â”‚                    â”‚
   â”‚                       â”‚  )                   â”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
   â”‚ 12. Field filled      â”‚                      â”‚                    â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚
   â”‚                       â”‚                      â”‚                    â”‚
```

### Audio Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Audio Capture                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Microphone           AudioContext       Processor        Gemini API
      â”‚                    â”‚                  â”‚                â”‚
      â”‚ Raw Audio          â”‚                  â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                â”‚
      â”‚                    â”‚                  â”‚                â”‚
      â”‚                    â”‚ Float32 PCM      â”‚                â”‚
      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
      â”‚                    â”‚                  â”‚                â”‚
      â”‚                    â”‚                  â”‚ Convert to     â”‚
      â”‚                    â”‚                  â”‚ Int16 PCM      â”‚
      â”‚                    â”‚                  â”‚                â”‚
      â”‚                    â”‚                  â”‚ Base64 encode  â”‚
      â”‚                    â”‚                  â”‚                â”‚
      â”‚                    â”‚                  â”‚ Stream chunks  â”‚
      â”‚                    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                    â”‚                  â”‚                â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Audio Playback                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Gemini API         Decoder           AudioContext       Speaker
      â”‚                  â”‚                  â”‚                â”‚
      â”‚ Base64 audio     â”‚                  â”‚                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                â”‚
      â”‚                  â”‚                  â”‚                â”‚
      â”‚                  â”‚ Decode PCM16     â”‚                â”‚
      â”‚                  â”‚                  â”‚                â”‚
      â”‚                  â”‚ Create buffer    â”‚                â”‚
      â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
      â”‚                  â”‚                  â”‚                â”‚
      â”‚                  â”‚                  â”‚ Play audio     â”‚
      â”‚                  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                  â”‚                  â”‚                â”‚
```

### Function Calling Schema

```javascript
{
  tools: [{
    functionDeclarations: [{
      name: "submitFieldValue",
      description: "Automatically fill a form field with the user's spoken value",

      parametersJsonSchema: {
        type: "object",
        properties: {
          fieldLabel: {
            type: "string",
            description: "The EXACT label of the form field (e.g., 'Email Address')"
          },
          value: {
            type: "string",
            description: "The value the user provided (e.g., 'john@example.com')"
          }
        },
        required: ["fieldLabel", "value"]
      }
    }]
  }]
}
```

**Example Function Call from AI:**
```json
{
  "toolCall": {
    "functionCalls": [{
      "name": "submitFieldValue",
      "id": "call_abc123",
      "args": {
        "fieldLabel": "Email Address",
        "value": "john.doe@example.com"
      }
    }]
  }
}
```

**Function Response to AI:**
```json
{
  "turns": [{
    "role": "user",
    "parts": [{
      "functionResponse": {
        "name": "submitFieldValue",
        "id": "call_abc123",
        "response": {
          "success": true
        }
      }
    }]
  }]
}
```

---

## Security & Privacy

### Data Encryption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Data at Rest                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Local Storage (Chrome):                                 â”‚
â”‚  - Encrypted by Chrome automatically                     â”‚
â”‚  - OS-level encryption (FileVault/BitLocker)             â”‚
â”‚  - No network transmission                               â”‚
â”‚                                                          â”‚
â”‚  Cloud Storage (Google):                                 â”‚
â”‚  - AES-256 encryption at rest                            â”‚
â”‚  - Automatic key rotation                                â”‚
â”‚  - Isolated per user (UUID-based paths)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Data in Transit                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Extension â†” Gemini API:                                 â”‚
â”‚  - TLS 1.3                                               â”‚
â”‚  - HTTPS only                                            â”‚
â”‚  - Certificate pinning                                   â”‚
â”‚                                                          â”‚
â”‚  Extension â†” Cloud Functions:                            â”‚
â”‚  - TLS 1.3                                               â”‚
â”‚  - CORS-enabled (Chrome extensions only)                 â”‚
â”‚  - API key in headers (encrypted)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IAM Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Google Cloud IAM Configuration                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Service Account:                                        â”‚
â”‚  - PROJECT_NUMBER-compute@developer.gserviceaccount.com  â”‚
â”‚                                                          â”‚
â”‚  Roles:                                                  â”‚
â”‚  - roles/storage.admin                                   â”‚
â”‚    (Read/write to Cloud Storage)                         â”‚
â”‚                                                          â”‚
â”‚  - roles/cloudfunctions.invoker                          â”‚
â”‚    (Execute Cloud Functions)                             â”‚
â”‚                                                          â”‚
â”‚  - roles/logging.logWriter                               â”‚
â”‚    (Write logs for debugging)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Privacy Guarantees

| Data Type | Local Mode | Cloud Mode |
|-----------|-----------|------------|
| **Document Content** | âœ… Never leaves device | âš ï¸ Sent to Gemini API for embedding |
| **Embeddings** | âœ… Stored locally only | âš ï¸ Stored in Cloud Storage |
| **Form Data** | âš ï¸ Sent to AI for analysis | âš ï¸ Sent to AI for analysis |
| **API Keys** | âœ… Chrome Storage (encrypted) | âœ… Chrome Storage (encrypted) |
| **User ID** | âœ… Generated locally (UUID) | âœ… Generated locally (UUID) |

---

## Performance Optimization

### Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cache Layers                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 1: In-Memory Cache (Service Worker)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ - Knowledge base chunks (100MB max)     â”‚
  â”‚ - Recently used embeddings              â”‚
  â”‚ - Form field mappings                   â”‚
  â”‚ - TTL: Until service worker restarts    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 2: Chrome Storage API
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ - Persistent embeddings (10MB max)      â”‚
  â”‚ - User settings                         â”‚
  â”‚ - Document metadata                     â”‚
  â”‚ - TTL: Infinite (until user clears)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Layer 3: Cloud Storage
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ - All embeddings (unlimited)            â”‚
  â”‚ - Multi-device sync                     â”‚
  â”‚ - Automatic backup                      â”‚
  â”‚ - TTL: User-controlled                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Batching

```javascript
// Batch multiple embedding requests
const batchEmbeddings = async (chunks) => {
  const batchSize = 10;
  const results = [];

  for (let i = 0; i < chunks.length; i += batchSize) {
    const batch = chunks.slice(i, i + batchSize);

    // Parallel requests within batch
    const embeddings = await Promise.all(
      batch.map(chunk => generateEmbedding(chunk))
    );

    results.push(...embeddings);
  }

  return results;
};
```

---

## Monitoring & Logging

### Cloud Function Logs

```bash
# View logs for specific function
gcloud functions logs read save-embeddings --region=us-central1 --limit=50

# Stream logs in real-time
gcloud functions logs tail save-embeddings --region=us-central1

# Filter by severity
gcloud functions logs read save-embeddings --filter="severity>=ERROR"
```

### Extension Logs

**Service Worker Console:**
```javascript
// Structured logging
console.log('ğŸ¯ Form Analysis:', {
  tokens: estimatedTokens,
  mode: useOnlyCloud ? 'CLOUD' : 'ON_DEVICE',
  fields: fieldCount,
  timestamp: Date.now()
});
```

**Content Script Console:**
```javascript
// Structured logging
console.log('âœ… Form Filled:', {
  totalFields: fields.length,
  filledFields: filledCount,
  successRate: (filledCount / fields.length * 100).toFixed(1) + '%',
  timestamp: Date.now()
});
```

---

## Deployment Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Development Workflow                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Local Development
       â”‚
       â”‚ npm run build
       â”‚
       â–¼
  Webpack Bundling
  (src/ â†’ dist/)
       â”‚
       â”‚
       â–¼
  Load Unpacked
  (chrome://extensions/)
       â”‚
       â”‚ Test locally
       â”‚
       â–¼
  Cloud Functions
  Deployment
       â”‚
       â”‚ ./deploy-cloud-storage.sh
       â”‚
       â–¼
  Google Cloud
  (us-central1)
       â”‚
       â”‚ ./test-cloud-storage.sh
       â”‚
       â–¼
  Production Ready
```

---

## Appendix: Technology Versions

| Technology | Version | Purpose |
|-----------|---------|---------|
| Chrome Manifest | V3 | Extension framework |
| Google Cloud Functions | Gen2 | Serverless backend |
| Python Runtime | 3.11 | Cloud Functions |
| Node.js | 18.x | Build tooling |
| Webpack | 5.x | Module bundling |
| Gemini 2.5 Flash | Latest | Form analysis |
| Gemini Live API | 2.5 | Voice assistant |
| Gemini Embedding | text-embedding-004 | Semantic search |
| Chrome Gemini Nano | Latest | On-device AI (optional) |

---

*For implementation details, see source code and inline comments.*
